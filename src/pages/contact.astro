---
import ContactForm from '../components/ContactForm.astro'
import Heading from '../components/Heading.astro'
import Layout from '../layouts/Layout.astro'

if (Astro.request.method === 'POST') {
    const data = await Astro.request.formData()
    const name = data.get('name')
    const email = data.get('email')
    const message = data.get('message')

    if (!name || !email || !message) {
        console.log('Missing data', { name, email, message })
    }
    if (name && email && message) {
        await fetch('https://api.brevo.com/v3/smtp/email', {
            method: 'POST',
            headers: {
                accept: 'application/json',
                'api-key': import.meta.env.EMAIL_API_KEY,
                'content-type': 'application/json',
            },
            body: JSON.stringify({
                sender: {
                    name,
                    email,
                },
                to: [
                    {
                        email: 'eniszej@gmail.com',
                        name: 'Enis',
                    },
                ],
                subject: `Hello, ${name} is on your Website`,
                textContent: message,
            }),
        })
    }
}
---

<Layout
    seo={{
        title: 'Contact',
    }}
>
    <section class="space-y-4 scroll-m-16" id="contact">
        <Heading>Contact</Heading>
        <ContactForm />
    </section>
</Layout>
